const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/photoRefQueue-D1gGZ7Iq.js","assets/PlaceDetails-CwexVQxr.js","assets/util-DDZ2ozR1.js"])))=>i.map(i=>d[i]);
import{r as T,_ as q}from"./RestaurantDetails-rBK7WBxa.js";import{googleKey as y,toggleFavorite as E,isFavorite as w,imageLoader as R}from"./util-DDZ2ozR1.js";import C from"./photoRefQueue-D1gGZ7Iq.js";import{a as M}from"./PlaceDetails-CwexVQxr.js";const v={};let _=null;typeof window<"u"&&(window.__cardRendererRetryState||(window.__cardRendererRetryState={list:[],timerSet:!1}));const O=1e4,U=800;function P(e,n){try{if(typeof window>"u"||!e)return;const t=window.__cardRendererRetryState;if(!t||t.list.some(a=>a.img===e))return;t.list.push({img:e,photoRef:n}),t.timerSet||(t.timerSet=!0,setTimeout(()=>{const a=Array.from(t.list);t.list=[],t.timerSet=!1,a.forEach((r,s)=>{const{img:o,photoRef:c}=r,l=s*U;setTimeout(()=>{try{if(!o||!document.body.contains(o)||o.dataset.retryAttempted==="1")return;const f=o.getAttribute("src")||"";if(!/placeholder/.test(f)||!c||(typeof window<"u"&&window.__cardRendererPhotoRefState?window.__cardRendererPhotoRefState:{disabled:!1}).disabled||x(c)>b)return;o.dataset.retryAttempted="1";try{C.enqueuePhotoRef(o,c,{googleKey:y,baseDelay:2e3,maxRetries:3,ttlMs:60*60*1e3})}catch{}}catch{}},l)})},O))}catch{}}const k="__cardRenderer_photoRefFailures_v1";function I(){try{const e=sessionStorage.getItem(k)||"{}";return JSON.parse(e||"{}")}catch{return{}}}function F(e){try{sessionStorage.setItem(k,JSON.stringify(e||{}))}catch{}}function S(e){if(e)try{const n=I();return n[e]=(n[e]||0)+1,F(n),n[e]}catch{return null}}function x(e){if(!e)return 0;try{return I()[e]||0}catch{return 0}}const b=2,A="__cardRenderer_hostFailures_v1";function $(){try{return JSON.parse(sessionStorage.getItem(A)||"{}")}catch{return{}}}function D(e){try{sessionStorage.setItem(A,JSON.stringify(e||{}))}catch{}}function B(e){try{const n=$(),t=n[e]||{failures:0,cooldownUntil:0};t.failures=(t.failures||0)+1;const a=1e4,r=5*60*1e3,s=Math.min(a*Math.pow(2,Math.max(0,t.failures-1)),r);return t.cooldownUntil=Date.now()+s,n[e]=t,D(n),t}catch{return null}}function L(e){return!e||typeof e!="string"?"":e.replace(/[-_]+/g," ").split(/\s+/).filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function N(){return _||(_=new IntersectionObserver(e=>{e.forEach(n=>{if(!n.isIntersecting)return;const t=n.target,a=t.dataset.src;if(a)try{if(/maps.googleapis.com\/maps\/api\/place\/photo/.test(a))try{const s=new URL(a),o=s.searchParams.get("photoreference")||s.searchParams.get("photo_reference");if(o)try{if(!C.enqueuePhotoRef(t,o,{googleKey:y})){try{t.dataset.photoRefBlocked="1"}catch{}try{j(t,o)}catch{}}}catch{try{R.enqueue(t,a).then(()=>{try{t.removeAttribute("data-src")}catch{}}).catch(()=>{try{t.removeAttribute("data-src")}catch{}})}catch{}}else R.enqueue(t,a).then(()=>{try{t.removeAttribute("data-src")}catch{}}).catch(()=>{try{t.removeAttribute("data-src")}catch{}})}catch{R.enqueue(t,a).then(()=>{try{t.removeAttribute("data-src")}catch{}}).catch(()=>{try{t.removeAttribute("data-src")}catch{}})}else R.enqueue(t,a).then(()=>{try{t.removeAttribute("data-src")}catch{}}).catch(()=>{try{t.removeAttribute("data-src")}catch{}})}catch{try{R.enqueue(t,a)}catch{}}try{_.unobserve(t)}catch{}})},{rootMargin:"200px 0px"}),_)}function j(e,n){try{if(e.dataset.clickToLoadAttached==="1")return;e.dataset.clickToLoadAttached="1",e.title="Image blocked to avoid quota; click to load",e.style.cursor="pointer";const t=async a=>{a.preventDefault(),a.stopPropagation();try{const r=await q(()=>import("./photoRefQueue-D1gGZ7Iq.js"),__vite__mapDeps([0,1,2])),s=r.enqueuePhotoRef||r.default&&r.default.enqueuePhotoRef;if(typeof s=="function")if(s(e,n,{googleKey:y})){try{e.removeAttribute("title")}catch{}try{e.style.cursor=""}catch{}try{delete e.dataset.photoRefBlocked}catch{}try{e.removeEventListener("click",t)}catch{}}else try{e.title="Still blocked — please try again later"}catch{}}catch(r){console.warn("click-to-load enqueue failed",r)}};e.addEventListener("click",t)}catch{}}function K(e,{mapHelpers:n=null,onFiltersReapply:t=null}={}){const a=M(e),r=document.createElement("article");r.className="result-card destination-card",r.dataset.placeId=a.id;const s=document.createElement("div");s.className="card-media ratio-2x1";const o=document.createElement("img");o.dataset.src=a.image,o.src=typeof import.meta<"u"&&v?"/wdd330-final-project-guatemala-touristic-guide/images/placeholder-2x1.svg":"/images/placeholder-2x1.svg",o.alt=a.name,o.onerror=()=>{if(!o.dataset.triedPhotoRef&&e&&e.photoRefs&&e.photoRefs.length&&y){o.dataset.triedPhotoRef="1",o.src=`https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photoreference=${encodeURIComponent(e.photoRefs[0])}&key=${y}`;return}const u=typeof import.meta<"u"&&v?"/wdd330-final-project-guatemala-touristic-guide/":"/";o.src=`${u}images/placeholder-2x1.svg`;try{const d=e&&e.photoRefs&&e.photoRefs.length?e.photoRefs[0]:null;if(o.dataset.triedPhotoRef==="1"&&d){const g=S(d)||0;try{B("lh3.googleusercontent.com")}catch{}g<=b&&P(o,d)}}catch{}},N().observe(o),s.appendChild(o),r.appendChild(s);const c=document.createElement("div");c.className="card-body";const l=document.createElement("h3");l.textContent=a.name,c.appendChild(l);const f=document.createElement("div");f.className="card-tags",(a.types||[]).forEach(u=>{const d=document.createElement("span");d.className="tag",d.textContent=L(u),f.appendChild(d)}),c.appendChild(f);const p=document.createElement("div");p.className="card-status",p.textContent=a.status||"Unknown",c.appendChild(p);const h=document.createElement("div");h.className="card-actions";const m=document.createElement("a");m.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.name)}&query_place_id=${encodeURIComponent(a.id)}`,m.textContent="Open in Google Maps",m.target="_blank",h.appendChild(m);const i=document.createElement("button");return i.className="fav-button",i.textContent=w(a.id,"destination")?"★":"☆",i.type="button",i.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),E(a.id,"destination"),i.textContent=w(a.id,"destination")?"★":"☆",typeof t=="function"&&t()}),h.appendChild(i),c.appendChild(h),r.appendChild(c),r.addEventListener("click",()=>{e.location&&n&&typeof n.setView=="function"&&typeof n.highlightMarker=="function"&&(n.setView({lat:e.location.lat,lng:e.location.lng,zoom:14}),n.highlightMarker(e.placeId,{bounce:!0}))}),r}function Q(e,{mapHelpers:n=null,onFiltersReapply:t=null}={}){const a=T(e);try{console.debug("createRestaurantCard",{id:a.id,name:a.name})}catch{}const r=document.createElement("article");r.className="result-card restaurant-card",r.dataset.placeId=a.id;const s=document.createElement("div");s.className="card-media ratio-1x1";const o=document.createElement("img");o.dataset.src=a.logo,o.src=typeof import.meta<"u"&&v?"/wdd330-final-project-guatemala-touristic-guide/images/restaurant-placeholder-1x1.svg":"/images/restaurant-placeholder-1x1.svg",o.alt=a.name,typeof window<"u"&&(window.__cardRendererPhotoRefState||(window.__cardRendererPhotoRefState={failures:0,disabled:!1})),o.onerror=()=>{const i=typeof window<"u"&&window.__cardRendererPhotoRefState?window.__cardRendererPhotoRefState:{failures:0,disabled:!1};if(!o.dataset.triedPhotoRef&&e&&e.photoRefs&&e.photoRefs.length&&y&&!i.disabled){o.dataset.triedPhotoRef="1",o.dataset.attemptedRef="1";try{o.src=`https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photoreference=${encodeURIComponent(e.photoRefs[0])}&key=${y}`}catch{}return}if(o.dataset.attemptedRef==="1"){try{i.failures=(i.failures||0)+1}catch{}try{const g=e&&e.photoRefs&&e.photoRefs.length?e.photoRefs[0]:null;g&&S(g)}catch{}if(i.failures>=3){try{i.disabled=!0}catch{}try{console.warn("cardRenderer: disabling photoRef retries after repeated failures")}catch{}}}const u=typeof import.meta<"u"&&v?"/wdd330-final-project-guatemala-touristic-guide/":"/";o.src=`${u}images/restaurant-placeholder-1x1.svg`;try{const d=e&&e.photoRefs&&e.photoRefs.length?e.photoRefs[0]:null;d&&!i.disabled&&x(d)<=b&&P(o,d)}catch{}},N().observe(o),s.appendChild(o),r.appendChild(s);const c=document.createElement("div");c.className="card-body";const l=document.createElement("h3");l.textContent=a.name,c.appendChild(l);const f=document.createElement("div");f.className="card-tags",(a.types||[]).slice(0,3).forEach(i=>{const u=document.createElement("span");u.className="tag",u.textContent=L(i),f.appendChild(u)}),c.appendChild(f);const p=document.createElement("div");p.className="card-status",p.textContent=a.status||"Unknown",c.appendChild(p);const h=document.createElement("div");h.className="card-actions";const m=document.createElement("a");return m.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.name)}&query_place_id=${encodeURIComponent(a.id)}`,m.textContent="Open in Google Maps",m.target="_blank",h.appendChild(m),favBtn.type="button",favBtn.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),E(a.id,"restaurant"),favBtn.textContent=w(a.id,"restaurant")?"★":"☆",typeof t=="function"&&t()}),h.appendChild(favBtn),c.appendChild(h),r.appendChild(c),r.addEventListener("click",()=>{e.location&&n&&typeof n.setView=="function"&&typeof n.highlightMarker=="function"&&(n.setView({lat:e.location.lat,lng:e.location.lng,zoom:14}),n.highlightMarker(e.placeId,{bounce:!0}))}),r}export{K as a,Q as c};
