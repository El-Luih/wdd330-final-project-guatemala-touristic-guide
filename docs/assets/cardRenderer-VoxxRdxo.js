const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/photoRefQueue-C64qX8mX.js","assets/RestaurantDetails-Cqs_NGMq.js","assets/util-DDZ2ozR1.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./preload-helper-b3APuFcS.js";import{googleKey as g,isFavorite as v,toggleFavorite as P,imageLoader as _}from"./util-DDZ2ozR1.js";import b from"./photoRefQueue-C64qX8mX.js";import{r as M,a as O}from"./RestaurantDetails-Cqs_NGMq.js";const E={};let w=null;typeof window<"u"&&(window.__cardRendererRetryState||(window.__cardRendererRetryState={list:[],timerSet:!1}));const U=1e4,F=800;function k(t,n){try{if(typeof window>"u"||!t)return;const e=window.__cardRendererRetryState;if(!e||e.list.some(a=>a.img===t))return;e.list.push({img:t,photoRef:n}),e.timerSet||(e.timerSet=!0,setTimeout(()=>{const a=Array.from(e.list);e.list=[],e.timerSet=!1,a.forEach((c,s)=>{const{img:o,photoRef:r}=c,u=s*F;setTimeout(()=>{try{if(!o||!document.body.contains(o)||o.dataset.retryAttempted==="1")return;const f=o.getAttribute("src")||"";if(!/placeholder/.test(f)||!r||(typeof window<"u"&&window.__cardRendererPhotoRefState?window.__cardRendererPhotoRefState:{disabled:!1}).disabled||A(r)>C)return;o.dataset.retryAttempted="1";try{b.enqueuePhotoRef(o,r,{googleKey:g,baseDelay:2e3,maxRetries:3,ttlMs:60*60*1e3})}catch{}}catch{}},u)})},U))}catch{}}const I="__cardRenderer_photoRefFailures_v1";function x(){try{const t=sessionStorage.getItem(I)||"{}";return JSON.parse(t||"{}")}catch{return{}}}function $(t){try{sessionStorage.setItem(I,JSON.stringify(t||{}))}catch{}}function S(t){if(t)try{const n=x();return n[t]=(n[t]||0)+1,$(n),n[t]}catch{return null}}function A(t){if(!t)return 0;try{return x()[t]||0}catch{return 0}}const C=2,L="__cardRenderer_hostFailures_v1";function D(){try{return JSON.parse(sessionStorage.getItem(L)||"{}")}catch{return{}}}function j(t){try{sessionStorage.setItem(L,JSON.stringify(t||{}))}catch{}}function B(t){try{const n=D(),e=n[t]||{failures:0,cooldownUntil:0};e.failures=(e.failures||0)+1;const a=1e4,c=5*60*1e3,s=Math.min(a*Math.pow(2,Math.max(0,e.failures-1)),c);return e.cooldownUntil=Date.now()+s,n[t]=e,j(n),e}catch{return null}}function N(t){return!t||typeof t!="string"?"":t.replace(/[-_]+/g," ").split(/\s+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}function q(){return w||(w=new IntersectionObserver(async t=>{t.forEach(async n=>{if(!n.isIntersecting)return;const e=n.target,a=e.dataset.src;if(a)try{if(/maps.googleapis.com\/maps\/api\/place\/photo/.test(a))try{const s=new URL(a),o=s.searchParams.get("photoreference")||s.searchParams.get("photo_reference");if(o)try{try{if(!await b.tryEnqueuePhotoRef(e,o,{googleKey:g})){try{e.dataset.photoRefBlocked="1"}catch{}try{V(e,o)}catch{}}}catch{b.enqueuePhotoRef(e,o,{googleKey:g})}}catch{try{_.enqueue(e,a).then(()=>{try{e.removeAttribute("data-src")}catch{}}).catch(()=>{try{e.removeAttribute("data-src")}catch{}})}catch{}}else _.enqueue(e,a).then(()=>{try{e.removeAttribute("data-src")}catch{}}).catch(()=>{try{e.removeAttribute("data-src")}catch{}})}catch{_.enqueue(e,a).then(()=>{try{e.removeAttribute("data-src")}catch{}}).catch(()=>{try{e.removeAttribute("data-src")}catch{}})}else _.enqueue(e,a).then(()=>{try{e.removeAttribute("data-src")}catch{}}).catch(()=>{try{e.removeAttribute("data-src")}catch{}})}catch{try{_.enqueue(e,a)}catch{}}try{w.unobserve(e)}catch{}})},{rootMargin:"200px 0px"}),w)}function V(t,n){try{if(t.dataset.clickToLoadAttached==="1")return;t.dataset.clickToLoadAttached="1",t.title="Image blocked to avoid quota; click to load",t.style.cursor="pointer";const e=async a=>{a.preventDefault(),a.stopPropagation();try{const c=await T(()=>import("./photoRefQueue-C64qX8mX.js"),__vite__mapDeps([0,1,2])),s=c.tryEnqueuePhotoRef||c.default&&c.default.tryEnqueuePhotoRef;if(typeof s=="function")if(await s(t,n,{googleKey:g})){try{t.removeAttribute("title")}catch{}try{t.style.cursor=""}catch{}try{delete t.dataset.photoRefBlocked}catch{}try{t.removeEventListener("click",e)}catch{}}else try{t.title="Still blocked — please try again later"}catch{}}catch(c){console.warn("click-to-load enqueue failed",c)}};t.addEventListener("click",e)}catch{}}function K(t,{mapHelpers:n=null,onFiltersReapply:e=null}={}){const a=O(t),c=document.createElement("article");c.className="result-card destination-card",c.dataset.placeId=a.id;const s=document.createElement("div");s.className="card-media ratio-2x1";const o=document.createElement("img");o.dataset.src=a.image,o.src=typeof import.meta<"u"&&E?"/wdd330-final-project-guatemala-touristic-guide/images/placeholder-2x1.svg":"/images/placeholder-2x1.svg",o.alt=a.name,o.onerror=()=>{if(!o.dataset.triedPhotoRef&&t&&t.photoRefs&&t.photoRefs.length&&g){o.dataset.triedPhotoRef="1",o.src=`https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photoreference=${encodeURIComponent(t.photoRefs[0])}&key=${g}`;return}const i=typeof import.meta<"u"&&E?"/wdd330-final-project-guatemala-touristic-guide/":"/";o.src=`${i}images/placeholder-2x1.svg`;try{const d=t&&t.photoRefs&&t.photoRefs.length?t.photoRefs[0]:null;if(o.dataset.triedPhotoRef==="1"&&d){const y=S(d)||0;try{B("lh3.googleusercontent.com")}catch{}y<=C&&k(o,d)}}catch{}},q().observe(o),s.appendChild(o),c.appendChild(s);const r=document.createElement("div");r.className="card-body";const u=document.createElement("h3");u.textContent=a.name,r.appendChild(u);const f=document.createElement("div");f.className="card-tags",(a.types||[]).forEach(i=>{const d=document.createElement("span");d.className="tag",d.textContent=N(i),f.appendChild(d)}),r.appendChild(f);const p=document.createElement("div");p.className="card-status",p.textContent=a.status||"Unknown",r.appendChild(p);const h=document.createElement("div");h.className="card-actions";const m=document.createElement("a");m.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.name)}&query_place_id=${encodeURIComponent(a.id)}`,m.textContent="Open in Google Maps",m.target="_blank",h.appendChild(m);const l=document.createElement("button");return l.className="fav-button",l.textContent=v(a.id,"destination")?"★":"☆",l.type="button",l.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),P(a.id,"destination"),l.textContent=v(a.id,"destination")?"★":"☆",typeof e=="function"&&e()}),h.appendChild(l),r.appendChild(h),c.appendChild(r),c.addEventListener("click",()=>{t.location&&n&&typeof n.setView=="function"&&typeof n.highlightMarker=="function"&&(n.setView({lat:t.location.lat,lng:t.location.lng,zoom:14}),n.highlightMarker(t.placeId,{bounce:!0}))}),c}function Q(t,{mapHelpers:n=null,onFiltersReapply:e=null}={}){const a=M(t);try{console.debug("createRestaurantCard",{id:a.id,name:a.name})}catch{}const c=document.createElement("article");c.className="result-card restaurant-card",c.dataset.placeId=a.id;const s=document.createElement("div");s.className="card-media ratio-1x1";const o=document.createElement("img");o.dataset.src=a.logo,o.src=typeof import.meta<"u"&&E?"/wdd330-final-project-guatemala-touristic-guide/images/restaurant-placeholder-1x1.svg":"/images/restaurant-placeholder-1x1.svg",o.alt=a.name,typeof window<"u"&&(window.__cardRendererPhotoRefState||(window.__cardRendererPhotoRefState={failures:0,disabled:!1})),o.onerror=()=>{const i=typeof window<"u"&&window.__cardRendererPhotoRefState?window.__cardRendererPhotoRefState:{failures:0,disabled:!1};if(!o.dataset.triedPhotoRef&&t&&t.photoRefs&&t.photoRefs.length&&g&&!i.disabled){o.dataset.triedPhotoRef="1",o.dataset.attemptedRef="1";try{o.src=`https://maps.googleapis.com/maps/api/place/photo?maxwidth=800&photoreference=${encodeURIComponent(t.photoRefs[0])}&key=${g}`}catch{}return}if(o.dataset.attemptedRef==="1"){try{i.failures=(i.failures||0)+1}catch{}try{const R=t&&t.photoRefs&&t.photoRefs.length?t.photoRefs[0]:null;R&&S(R)}catch{}if(i.failures>=3){try{i.disabled=!0}catch{}try{console.warn("cardRenderer: disabling photoRef retries after repeated failures")}catch{}}}const d=typeof import.meta<"u"&&E?"/wdd330-final-project-guatemala-touristic-guide/":"/";o.src=`${d}images/restaurant-placeholder-1x1.svg`;try{const y=t&&t.photoRefs&&t.photoRefs.length?t.photoRefs[0]:null;y&&!i.disabled&&A(y)<=C&&k(o,y)}catch{}},q().observe(o),s.appendChild(o),c.appendChild(s);const r=document.createElement("div");r.className="card-body";const u=document.createElement("h3");u.textContent=a.name,r.appendChild(u);const f=document.createElement("div");f.className="card-tags",(a.types||[]).slice(0,3).forEach(i=>{const d=document.createElement("span");d.className="tag",d.textContent=N(i),f.appendChild(d)}),r.appendChild(f);const p=document.createElement("div");p.className="card-status",p.textContent=a.status||"Unknown",r.appendChild(p);const h=document.createElement("div");h.className="card-actions";const m=document.createElement("a");m.href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.name)}&query_place_id=${encodeURIComponent(a.id)}`,m.textContent="Open in Google Maps",m.target="_blank",h.appendChild(m);const l=document.createElement("button");return l.type="button",l.className="fav-button",l.textContent=v(a.id,"restaurant")?"★":"☆",l.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),P(a.id,"restaurant"),l.textContent=v(a.id,"restaurant")?"★":"☆",typeof e=="function"&&e()}),h.appendChild(l),r.appendChild(h),c.appendChild(r),c.addEventListener("click",()=>{t.location&&n&&typeof n.setView=="function"&&typeof n.highlightMarker=="function"&&(n.setView({lat:t.location.lat,lng:t.location.lng,zoom:14}),n.highlightMarker(t.placeId,{bounce:!0}))}),c}export{K as a,Q as c};
