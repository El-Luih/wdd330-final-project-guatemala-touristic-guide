const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/util-DIxwDAXf.js","assets/util-lN-kmcTN.css"])))=>i.map(i=>d[i]);
import{loadHeaderFooter as k,debounce as q,loadFavorites as P}from"./util-DIxwDAXf.js";import{_ as F}from"./preload-helper-b3APuFcS.js";import{R as O,g as V,a as U,D as S,b as x}from"./RegionState-DqjB2VEy.js";let d=[],i=[],l=null;const h=6;let m=0;const L=3;let y=0,I="All";async function G(){try{console.info("CUISINE PAGE: full-card renderer active",{tag:"cuisine-v2"}),window.__CUISINE_RENDERER="full-v2"}catch{}k();try{const e=await F(()=>import("./util-DIxwDAXf.js"),__vite__mapDeps([0,1]));e&&e.imageLoader&&(e.imageLoader.concurrency=1,e.imageLoader.baseDelay=1e3,e.imageLoader.maxRetries=8)}catch(e){console.warn("Failed to adjust imageLoader for cuisine page",e)}const o=document.querySelector("#regions");if(o){o.innerHTML="";const e=document.createElement("option");e.value="All",e.textContent="All Regions",o.appendChild(e),Object.keys(O).forEach(r=>{const c=document.createElement("option");c.value=r,c.textContent=r,o.appendChild(c)})}let n=!0;try{await GoogleMapsAPI.load()}catch(e){console.warn("Maps load failed",e),n=!1}let t="All";try{const e=V();e&&(t=e)}catch{}try{U(t)}catch{}try{const e="__photoRefSessionBudget_v1";t&&t!=="All"&&!sessionStorage.getItem(e)&&sessionStorage.setItem(e,String(6))}catch{}try{sessionStorage.setItem("__photoRefAutoLimit_v1",String(3)),sessionStorage.setItem("__photoRefAutoUsed_v1",String(0))}catch{}if(I=t||"All",d=await PlacesAPI.fetchRestaurantsForRegion(I,18),(!d||d.length===0)&&t&&t!=="All"){console.debug("Cuisine: region fetch empty for",t," â€” falling back to global fetch");const e=await PlacesAPI.fetchRestaurantsForRegion("All",18);e&&e.length&&(d=e)}try{const e={};(d||[]).forEach(r=>{const c=r.region||"Unknown";e[c]=(e[c]||0)+1}),console.debug("Cuisine: fetched restaurants count",(d||[]).length,"by region",e)}catch{}if(n)try{N()}catch(e){console.warn("initMap failed",e),n=!1}n||(l={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null}),T(),E()}function N(){const o=document.querySelector(".map");l=GoogleMapsAPI.initMap(o,S)}function T(){const o=document.querySelector("#searchbar");o&&o.addEventListener("input",q(()=>E(),250)),document.querySelectorAll('input[name="status"]').forEach(t=>t.addEventListener("change",()=>E()));const n=document.querySelector("#regions");n&&n.addEventListener("change",()=>{const t=n.value||"All";try{location.href=x(location.href,t)}catch{D(t)}})}async function D(o="All"){try{i=await PlacesAPI.fetchRestaurantsForRegion(o,18)}catch(n){console.warn("Failed to fetch region restaurants",n),i=[]}b()}function E(){var R,A,w,C,_,v;const o=(w=(A=(R=document.querySelector("#searchbar"))==null?void 0:R.value)==null?void 0:A.toLowerCase())==null?void 0:w.trim(),n=((C=document.querySelector('input[name="status"]:checked'))==null?void 0:C.value)||"all",t=((_=document.querySelector("#regions"))==null?void 0:_.value)||"All";let e=[...d];t!=="All"&&t!==I&&(e=e.filter(a=>a.region===t)),n!=="all"&&(n==="open"&&(e=e.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),n==="closed"&&(e=e.filter(a=>(a.status||"").toLowerCase().includes("closed")))),o&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(o)||(a.types||[]).some(f=>f.toLowerCase().includes(o))));const r=P();e.sort((a,f)=>(r.restaurants.includes(a.placeId)?0:1)-(r.restaurants.includes(f.placeId)?0:1));const c=18,s=10,g=((v=document.querySelector("#regions"))==null?void 0:v.value)||"All";let u=[];if(g!=="All"){const a=e.filter(p=>p.region===g),f=e.filter(p=>p.region!==g);u=a.slice(0,s);const M=c-u.length;u=u.concat(f.slice(0,M))}else u=e.slice(0,c);i=u.slice(0,c),b()}function H(){const o=document.querySelector(".restaurants.container");o&&(o.innerHTML=""),l&&l.clearMarkers()}function b(){H();const o=document.querySelector(".restaurants.container");if(!o)return;if(m=0,i.slice(0,h).forEach(t=>{const e=createRestaurantCard(t,{mapHelpers:l});o.appendChild(e),t.location&&l.addMarker(t.placeId,{lat:t.location.lat,lng:t.location.lng},{title:t.name,onClick:()=>{const r=o.querySelector(`[data-place-id='${t.placeId}']`);r&&r.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(t.placeId,{bounce:!0})}})}),i.length>h){let t=document.querySelector("#show-more-restaurants");t||(t=document.createElement("button"),t.id="show-more-restaurants",t.className="show-more",t.textContent="Show more",t.addEventListener("click",()=>{if(y>=L){t.disabled=!0,t.textContent="Show more (limit reached)";return}y++,m++;const e=m*h,r=Math.min(i.length,(m+1)*h);i.slice(e,r).forEach(s=>{const g=createRestaurantCard(s,{mapHelpers:l});o.appendChild(g),s.location&&l.addMarker(s.placeId,{lat:s.location.lat,lng:s.location.lng},{title:s.name,onClick:()=>{const u=o.querySelector(`[data-place-id='${s.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(s.placeId,{bounce:!0})}})}),(m+1)*h>=i.length?t.remove():y>=L&&(t.disabled=!0,t.textContent="Show more (limit reached)")}),o.parentElement.appendChild(t))}if(!i||i.length===0)l.setView(S);else if(i.length===1){const t=i[0];t.location&&l.setView({lat:t.location.lat,lng:t.location.lng,zoom:14})}else{const t=document.querySelector("#regions"),e=t?t.value:"All";e&&e!=="All"?l.setView(e):l.setView(S)}}document.addEventListener("DOMContentLoaded",G);
