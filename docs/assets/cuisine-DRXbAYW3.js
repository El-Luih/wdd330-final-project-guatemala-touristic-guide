import{loadHeaderFooter as O,debounce as P,loadFavorites as V}from"./util-DDZ2ozR1.js";import{_ as F}from"./RestaurantDetails-rBK7WBxa.js";import{R as x,G as A,P as M,D as S}from"./PlaceDetails-CwexVQxr.js";import{c as R}from"./cardRenderer-Cn7qtTAr.js";import"./photoRefQueue-D1gGZ7Iq.js";let k=[],i=[],r=null;const m=6;let f=0;const _=3;let p=0;async function G(){try{console.info("CUISINE PAGE: full-card renderer active",{tag:"cuisine-v2"}),window.__CUISINE_RENDERER="full-v2"}catch{}O();try{const e=await F(()=>import("./util-DDZ2ozR1.js"),[]);e&&e.imageLoader&&(e.imageLoader.concurrency=1,e.imageLoader.baseDelay=1e3,e.imageLoader.maxRetries=8)}catch(e){console.warn("Failed to adjust imageLoader for cuisine page",e)}const n=document.querySelector("#regions");if(n){n.innerHTML="";const e=document.createElement("option");e.value="All",e.textContent="All Regions",n.appendChild(e),Object.keys(x).forEach(t=>{const l=document.createElement("option");l.value=t,l.textContent=t,n.appendChild(l)})}let o=!0;try{await A.load()}catch(e){console.warn("Maps load failed",e),o=!1}try{const e=function(){try{return new URLSearchParams(location.search).get("region")}catch{return null}}(),t="__photoRefSessionBudget_v1";e&&e!=="All"&&!sessionStorage.getItem(t)&&sessionStorage.setItem(t,String(6))}catch{}if(k=await M.fetchRestaurantsForRegion("All",18),o)try{N()}catch(e){console.warn("initMap failed",e),o=!1}o||(r={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null}),D(),E()}function N(){const n=document.querySelector(".map");r=A.initMap(n,S)}function D(){const n=document.querySelector("#searchbar");n&&n.addEventListener("input",P(()=>E(),250)),document.querySelectorAll('input[name="status"]').forEach(e=>e.addEventListener("change",()=>E()));const o=document.querySelector("#regions");o&&o.addEventListener("change",()=>{const e=o.value||"All";try{location.href=addRegionToUrlString(location.href,e)}catch{T(e)}})}async function T(n="All"){try{i=await M.fetchRestaurantsForRegion(n,18)}catch(o){console.warn("Failed to fetch region restaurants",o),i=[]}b()}function E(){var y,w,I,v,C,L;const n=(I=(w=(y=document.querySelector("#searchbar"))==null?void 0:y.value)==null?void 0:w.toLowerCase())==null?void 0:I.trim(),o=((v=document.querySelector('input[name="status"]:checked'))==null?void 0:v.value)||"all",e=((C=document.querySelector("#regions"))==null?void 0:C.value)||"All";let t=[...k];e!=="All"&&(t=t.filter(a=>a.region===e)),o!=="all"&&(o==="open"&&(t=t.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),o==="closed"&&(t=t.filter(a=>(a.status||"").toLowerCase().includes("closed")))),n&&(t=t.filter(a=>(a.name||"").toLowerCase().includes(n)||(a.types||[]).some(d=>d.toLowerCase().includes(n))));const l=V();t.sort((a,d)=>(l.restaurants.includes(a.placeId)?0:1)-(l.restaurants.includes(d.placeId)?0:1));const g=18,c=10,u=((L=document.querySelector("#regions"))==null?void 0:L.value)||"All";let s=[];if(u!=="All"){const a=t.filter(h=>h.region===u),d=t.filter(h=>h.region!==u);s=a.slice(0,c);const q=g-s.length;s=s.concat(d.slice(0,q))}else s=t.slice(0,g);i=s.slice(0,g),b()}function U(){const n=document.querySelector(".restaurants.container");n&&(n.innerHTML=""),r&&r.clearMarkers()}function b(){U();const n=document.querySelector(".restaurants.container");if(!n)return;if(f=0,i.slice(0,m).forEach(e=>{const t=R(e,{mapHelpers:r});n.appendChild(t),e.location&&r.addMarker(e.placeId,{lat:e.location.lat,lng:e.location.lng},{title:e.name,onClick:()=>{const l=n.querySelector(`[data-place-id='${e.placeId}']`);l&&l.scrollIntoView({behavior:"smooth",block:"center"}),r.highlightMarker(e.placeId,{bounce:!0})}})}),i.length>m){let e=document.querySelector("#show-more-restaurants");e||(e=document.createElement("button"),e.id="show-more-restaurants",e.className="show-more",e.textContent="Show more",e.addEventListener("click",()=>{if(p>=_){e.disabled=!0,e.textContent="Show more (limit reached)";return}p++,f++;const t=f*m,l=Math.min(i.length,(f+1)*m);i.slice(t,l).forEach(c=>{const u=R(c,{mapHelpers:r});n.appendChild(u),c.location&&r.addMarker(c.placeId,{lat:c.location.lat,lng:c.location.lng},{title:c.name,onClick:()=>{const s=n.querySelector(`[data-place-id='${c.placeId}']`);s&&s.scrollIntoView({behavior:"smooth",block:"center"}),r.highlightMarker(c.placeId,{bounce:!0})}})}),(f+1)*m>=i.length?e.remove():p>=_&&(e.disabled=!0,e.textContent="Show more (limit reached)")}),n.parentElement.appendChild(e))}if(!i||i.length===0)r.setView(S);else if(i.length===1){const e=i[0];e.location&&r.setView({lat:e.location.lat,lng:e.location.lng,zoom:14})}else{const e=document.querySelector("#regions"),t=e?e.value:"All";t&&t!=="All"?r.setView(t):r.setView(S)}}document.addEventListener("DOMContentLoaded",G);
