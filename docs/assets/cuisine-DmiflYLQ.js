const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/util-B3WD78b1.js","assets/util-DwypfeK1.css"])))=>i.map(i=>d[i]);
import{loadHeaderFooter as O,debounce as P,loadFavorites as V}from"./util-B3WD78b1.js";import{_ as U}from"./preload-helper-b3APuFcS.js";import{R as x,G as k,g as G,b as N,P as S,D as E,c as T}from"./RestaurantDetails-C8OkAwBx.js";import{c as b}from"./cardRenderer-ClAyZpEq.js";import"./photoRefQueue-CLigL6ms.js";let d=[],i=[],l=null;const m=6;let h=0;const M=3;let y=0,R="All";async function D(){try{console.info("CUISINE PAGE: full-card renderer active",{tag:"cuisine-v2"}),window.__CUISINE_RENDERER="full-v2"}catch{}O();try{const e=await U(()=>import("./util-B3WD78b1.js"),__vite__mapDeps([0,1]));e&&e.imageLoader&&(e.imageLoader.concurrency=1,e.imageLoader.baseDelay=1e3,e.imageLoader.maxRetries=8)}catch(e){console.warn("Failed to adjust imageLoader for cuisine page",e)}const o=document.querySelector("#regions");if(o){o.innerHTML="";const e=document.createElement("option");e.value="All",e.textContent="All Regions",o.appendChild(e),Object.keys(x).forEach(r=>{const c=document.createElement("option");c.value=r,c.textContent=r,o.appendChild(c)})}let n=!0;try{await k.load()}catch(e){console.warn("Maps load failed",e),n=!1}let t="All";try{const e=G();e&&(t=e)}catch{}try{N(t)}catch{}try{const e="__photoRefSessionBudget_v1";t&&t!=="All"&&!sessionStorage.getItem(e)&&sessionStorage.setItem(e,String(6))}catch{}try{sessionStorage.setItem("__photoRefAutoLimit_v1",String(3)),sessionStorage.setItem("__photoRefAutoUsed_v1",String(0))}catch{}if(R=t||"All",d=await S.fetchRestaurantsForRegion(R,18),(!d||d.length===0)&&t&&t!=="All"){console.debug("Cuisine: region fetch empty for",t," â€” falling back to global fetch");const e=await S.fetchRestaurantsForRegion("All",18);e&&e.length&&(d=e)}try{const e={};(d||[]).forEach(r=>{const c=r.region||"Unknown";e[c]=(e[c]||0)+1}),console.debug("Cuisine: fetched restaurants count",(d||[]).length,"by region",e)}catch{}if(n)try{H()}catch(e){console.warn("initMap failed",e),n=!1}n||(l={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null}),B(),w()}function H(){const o=document.querySelector(".map");l=k.initMap(o,E)}function B(){const o=document.querySelector("#searchbar");o&&o.addEventListener("input",P(()=>w(),250)),document.querySelectorAll('input[name="status"]').forEach(t=>t.addEventListener("change",()=>w()));const n=document.querySelector("#regions");n&&n.addEventListener("change",()=>{const t=n.value||"All";try{location.href=T(location.href,t)}catch{W(t)}})}async function W(o="All"){try{i=await S.fetchRestaurantsForRegion(o,18)}catch(n){console.warn("Failed to fetch region restaurants",n),i=[]}q()}function w(){var I,_,v,A,C,L;const o=(v=(_=(I=document.querySelector("#searchbar"))==null?void 0:I.value)==null?void 0:_.toLowerCase())==null?void 0:v.trim(),n=((A=document.querySelector('input[name="status"]:checked'))==null?void 0:A.value)||"all",t=((C=document.querySelector("#regions"))==null?void 0:C.value)||"All";let e=[...d];t!=="All"&&t!==R&&(e=e.filter(a=>a.region===t)),n!=="all"&&(n==="open"&&(e=e.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),n==="closed"&&(e=e.filter(a=>(a.status||"").toLowerCase().includes("closed")))),o&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(o)||(a.types||[]).some(f=>f.toLowerCase().includes(o))));const r=V();e.sort((a,f)=>(r.restaurants.includes(a.placeId)?0:1)-(r.restaurants.includes(f.placeId)?0:1));const c=18,s=10,g=((L=document.querySelector("#regions"))==null?void 0:L.value)||"All";let u=[];if(g!=="All"){const a=e.filter(p=>p.region===g),f=e.filter(p=>p.region!==g);u=a.slice(0,s);const F=c-u.length;u=u.concat(f.slice(0,F))}else u=e.slice(0,c);i=u.slice(0,c),q()}function j(){const o=document.querySelector(".restaurants.container");o&&(o.innerHTML=""),l&&l.clearMarkers()}function q(){j();const o=document.querySelector(".restaurants.container");if(!o)return;if(h=0,i.slice(0,m).forEach(t=>{const e=b(t,{mapHelpers:l});o.appendChild(e),t.location&&l.addMarker(t.placeId,{lat:t.location.lat,lng:t.location.lng},{title:t.name,onClick:()=>{const r=o.querySelector(`[data-place-id='${t.placeId}']`);r&&r.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(t.placeId,{bounce:!0})}})}),i.length>m){let t=document.querySelector("#show-more-restaurants");t||(t=document.createElement("button"),t.id="show-more-restaurants",t.className="show-more",t.textContent="Show more",t.addEventListener("click",()=>{if(y>=M){t.disabled=!0,t.textContent="Show more (limit reached)";return}y++,h++;const e=h*m,r=Math.min(i.length,(h+1)*m);i.slice(e,r).forEach(s=>{const g=b(s,{mapHelpers:l});o.appendChild(g),s.location&&l.addMarker(s.placeId,{lat:s.location.lat,lng:s.location.lng},{title:s.name,onClick:()=>{const u=o.querySelector(`[data-place-id='${s.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(s.placeId,{bounce:!0})}})}),(h+1)*m>=i.length?t.remove():y>=M&&(t.disabled=!0,t.textContent="Show more (limit reached)")}),o.parentElement.appendChild(t))}if(!i||i.length===0)l.setView(E);else if(i.length===1){const t=i[0];t.location&&l.setView({lat:t.location.lat,lng:t.location.lng,zoom:14})}else{const t=document.querySelector("#regions"),e=t?t.value:"All";e&&e!=="All"?l.setView(e):l.setView(E)}}document.addEventListener("DOMContentLoaded",D);
