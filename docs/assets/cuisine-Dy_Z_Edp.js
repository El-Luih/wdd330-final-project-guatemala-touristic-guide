import{loadHeaderFooter as O,debounce as F,loadFavorites as P}from"./util-DDZ2ozR1.js";import{_ as V,c as _}from"./cardRenderer-Cg7Vpnng.js";import{R as x,G as M,c as G,d as N,P as E,D as S,b as T}from"./PlaceDetails-DsYDr_P2.js";let d=[],i=[],l=null;const m=6;let h=0;const b=3;let y=0;async function U(){try{console.info("CUISINE PAGE: full-card renderer active",{tag:"cuisine-v2"}),window.__CUISINE_RENDERER="full-v2"}catch{}O();try{const e=await V(()=>import("./util-DDZ2ozR1.js"),[]);e&&e.imageLoader&&(e.imageLoader.concurrency=1,e.imageLoader.baseDelay=1e3,e.imageLoader.maxRetries=8)}catch(e){console.warn("Failed to adjust imageLoader for cuisine page",e)}const n=document.querySelector("#regions");if(n){n.innerHTML="";const e=document.createElement("option");e.value="All",e.textContent="All Regions",n.appendChild(e),Object.keys(x).forEach(r=>{const c=document.createElement("option");c.value=r,c.textContent=r,n.appendChild(c)})}let o=!0;try{await M.load()}catch(e){console.warn("Maps load failed",e),o=!1}let t="All";try{const e=G();e&&(t=e)}catch{}try{N(t)}catch{}try{const e="__photoRefSessionBudget_v1";t&&t!=="All"&&!sessionStorage.getItem(e)&&sessionStorage.setItem(e,String(6))}catch{}if(d=await E.fetchRestaurantsForRegion(t||"All",18),(!d||d.length===0)&&t&&t!=="All"){console.debug("Cuisine: region fetch empty for",t," â€” falling back to global fetch");const e=await E.fetchRestaurantsForRegion("All",18);e&&e.length&&(d=e)}try{const e={};(d||[]).forEach(r=>{const c=r.region||"Unknown";e[c]=(e[c]||0)+1}),console.debug("Cuisine: fetched restaurants count",(d||[]).length,"by region",e)}catch{}if(o)try{D()}catch(e){console.warn("initMap failed",e),o=!1}o||(l={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null}),H(),w()}function D(){const n=document.querySelector(".map");l=M.initMap(n,S)}function H(){const n=document.querySelector("#searchbar");n&&n.addEventListener("input",F(()=>w(),250)),document.querySelectorAll('input[name="status"]').forEach(t=>t.addEventListener("change",()=>w()));const o=document.querySelector("#regions");o&&o.addEventListener("change",()=>{const t=o.value||"All";try{location.href=T(location.href,t)}catch{B(t)}})}async function B(n="All"){try{i=await E.fetchRestaurantsForRegion(n,18)}catch(o){console.warn("Failed to fetch region restaurants",o),i=[]}k()}function w(){var C,I,R,v,A,L;const n=(R=(I=(C=document.querySelector("#searchbar"))==null?void 0:C.value)==null?void 0:I.toLowerCase())==null?void 0:R.trim(),o=((v=document.querySelector('input[name="status"]:checked'))==null?void 0:v.value)||"all",t=((A=document.querySelector("#regions"))==null?void 0:A.value)||"All";let e=[...d];t!=="All"&&(e=e.filter(a=>a.region===t)),o!=="all"&&(o==="open"&&(e=e.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),o==="closed"&&(e=e.filter(a=>(a.status||"").toLowerCase().includes("closed")))),n&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(n)||(a.types||[]).some(g=>g.toLowerCase().includes(n))));const r=P();e.sort((a,g)=>(r.restaurants.includes(a.placeId)?0:1)-(r.restaurants.includes(g.placeId)?0:1));const c=18,s=10,f=((L=document.querySelector("#regions"))==null?void 0:L.value)||"All";let u=[];if(f!=="All"){const a=e.filter(p=>p.region===f),g=e.filter(p=>p.region!==f);u=a.slice(0,s);const q=c-u.length;u=u.concat(g.slice(0,q))}else u=e.slice(0,c);i=u.slice(0,c),k()}function W(){const n=document.querySelector(".restaurants.container");n&&(n.innerHTML=""),l&&l.clearMarkers()}function k(){W();const n=document.querySelector(".restaurants.container");if(!n)return;if(h=0,i.slice(0,m).forEach(t=>{const e=_(t,{mapHelpers:l});n.appendChild(e),t.location&&l.addMarker(t.placeId,{lat:t.location.lat,lng:t.location.lng},{title:t.name,onClick:()=>{const r=n.querySelector(`[data-place-id='${t.placeId}']`);r&&r.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(t.placeId,{bounce:!0})}})}),i.length>m){let t=document.querySelector("#show-more-restaurants");t||(t=document.createElement("button"),t.id="show-more-restaurants",t.className="show-more",t.textContent="Show more",t.addEventListener("click",()=>{if(y>=b){t.disabled=!0,t.textContent="Show more (limit reached)";return}y++,h++;const e=h*m,r=Math.min(i.length,(h+1)*m);i.slice(e,r).forEach(s=>{const f=_(s,{mapHelpers:l});n.appendChild(f),s.location&&l.addMarker(s.placeId,{lat:s.location.lat,lng:s.location.lng},{title:s.name,onClick:()=>{const u=n.querySelector(`[data-place-id='${s.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(s.placeId,{bounce:!0})}})}),(h+1)*m>=i.length?t.remove():y>=b&&(t.disabled=!0,t.textContent="Show more (limit reached)")}),n.parentElement.appendChild(t))}if(!i||i.length===0)l.setView(S);else if(i.length===1){const t=i[0];t.location&&l.setView({lat:t.location.lat,lng:t.location.lng,zoom:14})}else{const t=document.querySelector("#regions"),e=t?t.value:"All";e&&e!=="All"?l.setView(e):l.setView(S)}}document.addEventListener("DOMContentLoaded",U);
