import{loadHeaderFooter as L,debounce as M,loadFavorites as k}from"./util-DIxwDAXf.js";import{R as A,g as R,a as q,b as O,D as C}from"./RegionState-DqjB2VEy.js";let c=[],i=null;const f=6;let m=0;const b=3;let p=0;const _=Object.keys(A);async function F(){L();const t=document.querySelector("#regions");if(t){t.innerHTML="";const n=document.createElement("option");n.value="All",n.textContent="All Regions",t.appendChild(n),Object.keys(A).forEach(s=>{const e=document.createElement("option");e.value=s,e.textContent=s,t.appendChild(e)}),t.addEventListener("change",()=>E(t.value))}x(),P();let o=!0;try{await GoogleMapsAPI.load()}catch(n){console.warn("GoogleMapsAPI failed to load, continuing without map",n),o=!1}if(o)try{V()}catch(n){console.warn("initMap failed, creating fallback mapHelpers",n),o=!1}o||(i={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null});const l=R();try{const n="__photoRefSessionBudget_v1";l&&l!=="All"&&!sessionStorage.getItem(n)&&sessionStorage.setItem(n,String(6))}catch{}l?(q(l),await y(l)):await y("All")}async function y(t="All"){try{c=await PlacesAPI.fetchAttractionsForRegion(t,18)}catch(o){console.warn("Failed to fetch region attractions",o),c=[]}S()}function x(){const t=document.querySelector(".filtering-buttons");if(!t)return;t.innerHTML="";const o=document.createElement("button");o.className="filter-button active",o.textContent="All",o.dataset.region="All",t.appendChild(o),o.addEventListener("click",()=>{E("All")}),_.forEach(l=>{const n=document.createElement("button");n.className="filter-button",n.textContent=l,n.dataset.region=l,n.addEventListener("click",()=>E(l)),t.appendChild(n)})}function E(t){try{const o=O(location.href,t);location.href=o}catch{document.querySelectorAll(".filter-button").forEach(l=>l.classList.toggle("active",l.dataset.region===t)),y(t)}}function P(){document.querySelector("#searchbar").addEventListener("input",M(()=>w(),300)),document.querySelectorAll('input[name="status"]').forEach(o=>o.addEventListener("change",()=>{var n;const l=((n=document.querySelector(".filter-button.active"))==null?void 0:n.dataset.region)||"All";w(l,o.value)}))}function V(){const t=document.querySelector(".map");i=GoogleMapsAPI.initMap(t,C)}function w(t="All",o="all"){var d,g,r;const l=(r=(g=(d=document.querySelector("#searchbar"))==null?void 0:d.value)==null?void 0:g.toLowerCase())==null?void 0:r.trim();let n=[...c];t&&t!=="All"&&(n=n.filter(a=>a.region===t)),o&&o!=="all"&&(o==="open"&&(n=n.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),o==="closed"&&(n=n.filter(a=>typeof a.isOpen=="boolean"?!a.isOpen:(a.status||"").toLowerCase().includes("closed")))),l&&(n=n.filter(a=>(a.name||"").toLowerCase().includes(l)||(a.types||[]).some(u=>u.toLowerCase().includes(l))));const s=k();n.sort((a,u)=>{const v=s.destinations.includes(a.placeId)?0:1,I=s.destinations.includes(u.placeId)?0:1;return v-I}),c=n.slice(0,18),S()}function G(){const t=document.querySelector(".destinations.container");t&&(t.innerHTML="")}function S(){var s;G();const t=document.querySelector(".destinations.container");i.clearMarkers();const o=0;m=0;const l=Math.min(c.length,f);if(c.slice(o,l).forEach(e=>{const h=createAttractionCard(e,{mapHelpers:i});t.appendChild(h),e.location&&i.addMarker(e.placeId,{lat:e.location.lat,lng:e.location.lng},{title:e.name,onClick:()=>{const d=t.querySelector(`[data-place-id='${e.placeId}']`);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),i.highlightMarker(e.placeId,{bounce:!0})}})}),c.length>f){let e=document.querySelector("#show-more-results");e||(e=document.createElement("button"),e.id="show-more-results",e.className="show-more",e.textContent="Show more",e.addEventListener("click",()=>{if(p>=b){e.disabled=!0,e.textContent="Show more (limit reached)";return}p++,m++;const h=m*f,d=Math.min(c.length,(m+1)*f);c.slice(h,d).forEach(r=>{const a=createAttractionCard(r,{mapHelpers:i});t.appendChild(a),r.location&&i.addMarker(r.placeId,{lat:r.location.lat,lng:r.location.lng},{title:r.name,onClick:()=>{const u=t.querySelector(`[data-place-id='${r.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),i.highlightMarker(r.placeId,{bounce:!0})}})}),(m+1)*f>=c.length?e.remove():p>=b&&(e.disabled=!0,e.textContent="Show more (limit reached)")}),t.parentElement.appendChild(e))}if(c.length===0)i.setView(C);else if(c.length===1){const e=c[0];e.location&&i.setView({lat:e.location.lat,lng:e.location.lng,zoom:14})}else{const e=(s=document.querySelector(".filter-button.active"))==null?void 0:s.dataset.region;e&&e!=="All"?i.setView(e):i.setView(C)}}document.addEventListener("DOMContentLoaded",F);
