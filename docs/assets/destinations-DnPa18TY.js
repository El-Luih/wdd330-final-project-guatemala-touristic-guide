import{loadHeaderFooter as k,debounce as R,loadFavorites as q}from"./util-DDZ2ozR1.js";import{R as v,G as A,D as C,P as O}from"./PlaceDetails-CwexVQxr.js";import{a as b}from"./cardRenderer-Cn7qtTAr.js";import{b as _,c as F,a as x}from"./RegionState-BV8WHhz9.js";import"./RestaurantDetails-rBK7WBxa.js";import"./photoRefQueue-D1gGZ7Iq.js";let c=[],i=null;const m=6;let f=0;const w=3;let p=0;const P=Object.keys(v);async function V(){k();const t=document.querySelector("#regions");if(t){t.innerHTML="";const n=document.createElement("option");n.value="All",n.textContent="All Regions",t.appendChild(n),Object.keys(v).forEach(s=>{const e=document.createElement("option");e.value=s,e.textContent=s,t.appendChild(e)}),t.addEventListener("change",()=>E(t.value))}G(),T();let o=!0;try{await A.load()}catch(n){console.warn("GoogleMapsAPI failed to load, continuing without map",n),o=!1}if(o)try{H()}catch(n){console.warn("initMap failed, creating fallback mapHelpers",n),o=!1}o||(i={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null});const l=_();try{const n="__photoRefSessionBudget_v1";l&&l!=="All"&&!sessionStorage.getItem(n)&&sessionStorage.setItem(n,String(6))}catch{}l?(F(l),await y(l)):await y("All")}async function y(t="All"){try{c=await O.fetchAttractionsForRegion(t,18)}catch(o){console.warn("Failed to fetch region attractions",o),c=[]}I()}function G(){const t=document.querySelector(".filtering-buttons");if(!t)return;t.innerHTML="";const o=document.createElement("button");o.className="filter-button active",o.textContent="All",o.dataset.region="All",t.appendChild(o),o.addEventListener("click",()=>{E("All")}),P.forEach(l=>{const n=document.createElement("button");n.className="filter-button",n.textContent=l,n.dataset.region=l,n.addEventListener("click",()=>E(l)),t.appendChild(n)})}function E(t){try{const o=x(location.href,t);location.href=o}catch{document.querySelectorAll(".filter-button").forEach(l=>l.classList.toggle("active",l.dataset.region===t)),y(t)}}function T(){document.querySelector("#searchbar").addEventListener("input",R(()=>S(),300)),document.querySelectorAll('input[name="status"]').forEach(o=>o.addEventListener("change",()=>{var n;const l=((n=document.querySelector(".filter-button.active"))==null?void 0:n.dataset.region)||"All";S(l,o.value)}))}function H(){const t=document.querySelector(".map");i=A.initMap(t,C)}function S(t="All",o="all"){var d,g,r;const l=(r=(g=(d=document.querySelector("#searchbar"))==null?void 0:d.value)==null?void 0:g.toLowerCase())==null?void 0:r.trim();let n=[...c];t&&t!=="All"&&(n=n.filter(a=>a.region===t)),o&&o!=="all"&&(o==="open"&&(n=n.filter(a=>typeof a.isOpen=="boolean"?a.isOpen:(a.status||"").toLowerCase().includes("operational"))),o==="closed"&&(n=n.filter(a=>typeof a.isOpen=="boolean"?!a.isOpen:(a.status||"").toLowerCase().includes("closed")))),l&&(n=n.filter(a=>(a.name||"").toLowerCase().includes(l)||(a.types||[]).some(u=>u.toLowerCase().includes(l))));const s=q();n.sort((a,u)=>{const L=s.destinations.includes(a.placeId)?0:1,M=s.destinations.includes(u.placeId)?0:1;return L-M}),c=n.slice(0,18),I()}function U(){const t=document.querySelector(".destinations.container");t&&(t.innerHTML="")}function I(){var s;U();const t=document.querySelector(".destinations.container");i.clearMarkers();const o=0;f=0;const l=Math.min(c.length,m);if(c.slice(o,l).forEach(e=>{const h=b(e,{mapHelpers:i});t.appendChild(h),e.location&&i.addMarker(e.placeId,{lat:e.location.lat,lng:e.location.lng},{title:e.name,onClick:()=>{const d=t.querySelector(`[data-place-id='${e.placeId}']`);d&&d.scrollIntoView({behavior:"smooth",block:"center"}),i.highlightMarker(e.placeId,{bounce:!0})}})}),c.length>m){let e=document.querySelector("#show-more-results");e||(e=document.createElement("button"),e.id="show-more-results",e.className="show-more",e.textContent="Show more",e.addEventListener("click",()=>{if(p>=w){e.disabled=!0,e.textContent="Show more (limit reached)";return}p++,f++;const h=f*m,d=Math.min(c.length,(f+1)*m);c.slice(h,d).forEach(r=>{const a=b(r,{mapHelpers:i});t.appendChild(a),r.location&&i.addMarker(r.placeId,{lat:r.location.lat,lng:r.location.lng},{title:r.name,onClick:()=>{const u=t.querySelector(`[data-place-id='${r.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),i.highlightMarker(r.placeId,{bounce:!0})}})}),(f+1)*m>=c.length?e.remove():p>=w&&(e.disabled=!0,e.textContent="Show more (limit reached)")}),t.parentElement.appendChild(e))}if(c.length===0)i.setView(C);else if(c.length===1){const e=c[0];e.location&&i.setView({lat:e.location.lat,lng:e.location.lng,zoom:14})}else{const e=(s=document.querySelector(".filter-button.active"))==null?void 0:s.dataset.region;e&&e!=="All"?i.setView(e):i.setView(C)}}document.addEventListener("DOMContentLoaded",V);
