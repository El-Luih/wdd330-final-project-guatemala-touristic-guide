import{loadHeaderFooter as q,debounce as O,loadFavorites as V}from"./util-DBCvD-ly.js";import{R as A,G as M,g as _,b as F,c as x,D as h,P}from"./RestaurantDetails-DxH_l1Bt.js";import{a as y}from"./cardRenderer-DwqVo4el.js";import"./preload-helper-b3APuFcS.js";import"./photoRefQueue-Ddjgcq1B.js";let r=[],l=null;const m=6;let g=0;const E=3;let w=0;const G=Object.keys(A);async function T(){q();const t=document.querySelector("#regions");if(t){t.innerHTML="";const o=document.createElement("option");o.value="All",o.textContent="All Regions",t.appendChild(o),Object.keys(A).forEach(s=>{const e=document.createElement("option");e.value=s,e.textContent=s,t.appendChild(e)}),t.addEventListener("change",()=>I(t.value))}H(),U();let n=!0;try{await M.load()}catch(o){console.warn("GoogleMapsAPI failed to load, continuing without map",o),n=!1}if(n)try{B()}catch(o){console.warn("initMap failed, creating fallback mapHelpers",o),n=!1}n||(l={addMarker:()=>null,removeMarker:()=>null,clearMarkers:()=>null,highlightMarker:()=>null,setView:()=>null});const a=_();try{const o="__photoRefSessionBudget_v1";a&&a!=="All"&&!sessionStorage.getItem(o)&&sessionStorage.setItem(o,String(6))}catch{}a?(F(a),await C(a)):await C("All")}async function C(t="All"){try{r=await P.fetchAttractionsForRegion(t,18)}catch(n){console.warn("Failed to fetch region attractions",n),r=[]}D()}function H(){const t=document.querySelector(".filtering-buttons");if(!t)return;t.innerHTML="";const n=document.createElement("button");n.className="filter-button active",n.textContent="All",n.dataset.region="All",t.appendChild(n),n.addEventListener("click",()=>{I("All")}),G.forEach(a=>{const o=document.createElement("button");o.className="filter-button",o.textContent=a,o.dataset.region=a,o.addEventListener("click",()=>I(a)),t.appendChild(o)})}function I(t){try{const n=x(location.href,t);location.href=n}catch{document.querySelectorAll(".filter-button").forEach(a=>a.classList.toggle("active",a.dataset.region===t)),C(t)}}function U(){const t=document.querySelector("#searchbar");t&&t.addEventListener("input",O(()=>v(),300)),document.querySelectorAll('input[name="status"]').forEach(n=>n.addEventListener("change",()=>{v()}))}function B(){const t=document.querySelector(".map");l=M.initMap(t,h)}function v(){var d,p,f;const t=(f=(p=(d=document.querySelector("#searchbar"))==null?void 0:d.value)==null?void 0:p.toLowerCase())==null?void 0:f.trim(),n=document.querySelector("#regions"),a=n?n.value:"All",o=document.querySelector('input[name="status"]:checked'),s=o?o.value:"all";let e=[...r];a&&a!=="All"&&(e=e.filter(c=>c.region===a)),s&&s!=="all"&&(s==="open"&&(e=e.filter(c=>typeof c.isOpen=="boolean"?c.isOpen:(c.status||"").toLowerCase().includes("operational"))),s==="closed"&&(e=e.filter(c=>typeof c.isOpen=="boolean"?!c.isOpen:(c.status||"").toLowerCase().includes("closed")))),t&&(e=e.filter(c=>(c.name||"").toLowerCase().includes(t)||(c.types||[]).some(S=>S.toLowerCase().includes(t))));const i=V();e.sort((c,S)=>{const L=i.destinations.includes(c.placeId)?0:1,R=i.destinations.includes(S.placeId)?0:1;return L-R});let b=e.slice(0,18);N(b)}function k(){const t=document.querySelector(".destinations.container");t&&(t.innerHTML="")}function N(t){k();const n=document.querySelector(".destinations.container");l.clearMarkers();const a=0;g=0;const o=Math.min(t.length,m);if(t.slice(a,o).forEach(e=>{const i=y(e,{mapHelpers:l});n.appendChild(i),e.location&&l.addMarker(e.placeId,{lat:e.location.lat,lng:e.location.lng},{title:e.name,onClick:()=>{const u=n.querySelector(`[data-place-id='${e.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(e.placeId,{bounce:!0})}})}),t.length===0)l.setView(h);else if(t.length===1){const e=t[0];e.location&&l.setView({lat:e.location.lat,lng:e.location.lng,zoom:14})}else{const e=document.querySelector("#regions"),i=e?e.value:"All";i&&i!=="All"?l.setView(i):l.setView(h)}}function D(){var s;k();const t=document.querySelector(".destinations.container");l.clearMarkers();const n=0;g=0;const a=Math.min(r.length,m);if(r.slice(n,a).forEach(e=>{const i=y(e,{mapHelpers:l});t.appendChild(i),e.location&&l.addMarker(e.placeId,{lat:e.location.lat,lng:e.location.lng},{title:e.name,onClick:()=>{const u=t.querySelector(`[data-place-id='${e.placeId}']`);u&&u.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(e.placeId,{bounce:!0})}})}),r.length>m){let e=document.querySelector("#show-more-results");e||(e=document.createElement("button"),e.id="show-more-results",e.className="show-more",e.textContent="Show more",e.addEventListener("click",()=>{if(w>=E){e.disabled=!0,e.textContent="Show more (limit reached)";return}w++,g++;const i=g*m,u=Math.min(r.length,(g+1)*m);r.slice(i,u).forEach(d=>{const p=y(d,{mapHelpers:l});t.appendChild(p),d.location&&l.addMarker(d.placeId,{lat:d.location.lat,lng:d.location.lng},{title:d.name,onClick:()=>{const f=t.querySelector(`[data-place-id='${d.placeId}']`);f&&f.scrollIntoView({behavior:"smooth",block:"center"}),l.highlightMarker(d.placeId,{bounce:!0})}})}),(g+1)*m>=r.length?e.remove():w>=E&&(e.disabled=!0,e.textContent="Show more (limit reached)")}),t.parentElement.appendChild(e))}if(r.length===0)l.setView(h);else if(r.length===1){const e=r[0];e.location&&l.setView({lat:e.location.lat,lng:e.location.lng,zoom:14})}else{const e=(s=document.querySelector(".filter-button.active"))==null?void 0:s.dataset.region;e&&e!=="All"?l.setView(e):l.setView(h)}}document.addEventListener("DOMContentLoaded",T);
