import{loadHeaderFooter as w,isFavorite as p,toggleFavorite as f}from"./util-DIxwDAXf.js";const D=function(){const e="https://api.open-meteo.com/v1/forecast";async function a(o,c){const d=`${e}?latitude=${encodeURIComponent(o)}&longitude=${encodeURIComponent(c)}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`,s=await fetch(d);try{console.log("OpenMeteAPI.fetchDaily response",{url:d,ok:s.ok,status:s.status,headers:Object.fromEntries(s.headers)})}catch{}if(!s.ok)throw new Error("OpenMete fetch failed: "+s.status);const u=await s.clone().json();try{console.log("OpenMeteAPI.fetchDaily body",u)}catch{}return u}return{fetchDaily:a}}();function x(e){try{if(!e||!e.daily)return null;const{time:a,temperature_2m_max:o,temperature_2m_min:c,weathercode:d}=e.daily;return Array.isArray(a)?a.map((s,u)=>({date:s,max:(o==null?void 0:o[u])??null,min:(c==null?void 0:c[u])??null,code:(d==null?void 0:d[u])??null})):null}catch(a){return console.error("dailySummary: failed to parse OpenMeteo response",a),null}}const b={0:"clear.svg",1:"mainly_clear.svg",2:"partly_cloudy.svg",3:"overcast.svg",45:"fog.svg",48:"depositing_rime_fog.svg",51:"drizzle_light.svg",53:"drizzle_moderate.svg",55:"drizzle_dense.svg",56:"freezing_drizzle_light.svg",57:"freezing_drizzle_dense.svg",61:"rain_light.svg",63:"rain_moderate.svg",65:"rain_heavy.svg",66:"freezing_rain_light.svg",67:"freezing_rain_heavy.svg",71:"snow_light.svg",73:"snow_moderate.svg",75:"snow_heavy.svg",77:"snow_grains.svg",80:"rain_showers_light.svg",81:"rain_showers_moderate.svg",82:"rain_showers_violent.svg",85:"snow_showers_light.svg",86:"snow_showers_heavy.svg",95:"thunderstorm.svg",96:"thunderstorm_hail_light.svg",99:"thunderstorm_hail_heavy.svg"},y={BASE_URL:"/wdd330-final-project-guatemala-touristic-guide/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function A(e){return`${e.toFixed(1)}°C`}async function C(e,a,o="Guatemala"){try{const c=await D.fetchDaily(e,a),d=x(c);if(!d)return;const s=["weather-0","weather-1","weather-2"];for(let m=0;m<3;m++){const l=document.getElementById(s[m]);if(!l)continue;const t=d[m];if(l.innerHTML="",!t)continue;const n=m===0?"Today":m===1?"Tomorrow":new Date(t.date).toLocaleDateString(void 0,{weekday:"long"}),i=document.createElement("h4");i.textContent=n;const g=document.createElement("img"),r=b[t.code]||"clear.svg",h=import.meta&&y?"/wdd330-final-project-guatemala-touristic-guide/":"/";g.src=`${h}images/weather/${r}`,g.alt="weather",g.width=48,g.height=48,g.onerror=()=>{g.src=`${h}images/weather/clear.svg`};const v=document.createElement("div");v.textContent=A(t.max),l.appendChild(i),l.appendChild(g),l.appendChild(v)}const u=document.getElementById("weather-region");u&&(u.textContent=o)}catch(c){console.error("Weather fetch failed",c)}}function _(e){if(!e||e==="All")return DEFAULT_COUNTRY_VIEW.center;const a=REGION_VIEWS[e];return a?a.center:DEFAULT_COUNTRY_VIEW.center}function j(){const e=document.querySelector(".filtering-buttons");if(!e)return;e.innerHTML="";const a=document.createElement("button");a.dataset.region="All",a.textContent="All",e.appendChild(a),Object.keys(REGION_VIEWS).forEach(c=>{const d=document.createElement("button");d.dataset.region=c,d.textContent=c,e.appendChild(d)});let o="All";try{const c=getRegionFromQuery();c&&(o=c)}catch{}applyRegionToUI(o),e.addEventListener("click",c=>{const d=c.target.closest("button");if(!d)return;const s=d.dataset.region||"All";try{const u=addRegionToUrlString(location.href,s);location.href=u}catch{document.querySelectorAll(".filtering-buttons button").forEach(l=>l.classList.toggle("current",l.dataset.region===s));const m=_(s);C(m.lat,m.lng,s==="All"?"Guatemala":s)}})}function M(e){try{document.querySelectorAll(".filtering-buttons button").forEach(a=>a.classList.toggle("current",a.dataset.region===(e||"All")))}catch{}}function N(){const e=document.querySelectorAll("a.explore.button");!e||e.length===0||e.forEach(a=>{a.addEventListener("click",o=>{const c=getActiveRegionFromUI(),d=addRegionToUrlString(a.href,c);o.preventDefault(),location.href=d})})}document.addEventListener("DOMContentLoaded",()=>{w(),j();let e="All";try{const o=getRegionFromQuery();o&&(e=o)}catch{}M(e),N();const a=_(e);C(a.lat,a.lng,e==="All"?"Guatemala":e),(async()=>{try{const o=e||"All",[c,d]=await Promise.all([PlacesAPI.fetchAttractionsForRegion(o,6),PlacesAPI.fetchRestaurantsForRegion(o,6)]),s=document.querySelector(".destinations.container");s&&(s.innerHTML="",(c||[]).slice(0,6).forEach(m=>{const l=attractionCard(m),t=document.createElement("article");t.className="small-card";const n=document.createElement("div");n.className="card-media ratio-2x1";const i=document.createElement("img");i.src=l.image,i.alt=l.name,i.onerror=()=>{const h="/wdd330-final-project-guatemala-touristic-guide/";i.src=`${h}images/placeholder-2x1.svg`},n.appendChild(i),t.appendChild(n);const g=document.createElement("h4");g.textContent=l.name,t.appendChild(g);const r=document.createElement("button");r.type="button",r.className="fav-button",r.textContent=p(l.id,"destination")?"★":"☆",r.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),f(l.id,"destination"),r.textContent=p(l.id,"destination")?"★":"☆"}),t.appendChild(r),s.appendChild(t)}));const u=document.querySelector(".restaurants.container");u&&(u.innerHTML="",(d||[]).slice(0,6).forEach(m=>{const l=restaurantCard(m),t=document.createElement("article");t.className="small-card";const n=document.createElement("div");n.className="card-media ratio-1x1";const i=document.createElement("img");i.src=l.logo,i.alt=l.name,i.onerror=()=>{const h="/wdd330-final-project-guatemala-touristic-guide/";i.src=`${h}images/restaurant-placeholder-1x1.svg`},n.appendChild(i),t.appendChild(n);const g=document.createElement("h4");g.textContent=l.name,t.appendChild(g);const r=document.createElement("button");r.type="button",r.className="fav-button",r.textContent=p(l.id,"restaurant")?"★":"☆",r.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),f(l.id,"restaurant"),r.textContent=p(l.id,"restaurant")?"★":"☆"}),t.appendChild(r),u.appendChild(t)}))}catch(o){console.warn("Failed rendering main page gadgets",o)}})(),(async()=>{try{const o=await PlacesAPI.fetchAttractionsForRegion("All",18),c=document.querySelector(".destinations.container");if(!c)return;c.innerHTML="",o.slice(0,6).forEach(d=>{const s=attractionCard(d),u=document.createElement("article");u.className="small-card";const m=document.createElement("div");m.className="card-media ratio-2x1";const l=document.createElement("img");l.src=s.image,l.alt=s.name,l.onerror=()=>{const i="/wdd330-final-project-guatemala-touristic-guide/";l.src=`${i}images/placeholder-2x1.svg`},m.appendChild(l),u.appendChild(m);const t=document.createElement("h4");t.textContent=s.name,u.appendChild(t);const n=document.createElement("button");n.type="button",n.className="fav-button",n.textContent=p(s.id,"destination")?"★":"☆",n.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),f(s.id,"destination"),n.textContent=p(s.id,"destination")?"★":"☆"}),u.appendChild(n),c.appendChild(u)})}catch(o){console.warn("Failed rendering featured destinations",o)}})()});function E(e){if(!e)return null;const a=e.split("-").map(o=>o.padStart(2,"0"));return a.length!==2?null:{mm:parseInt(a[0],10),dd:parseInt(a[1],10)}}function S(e,a,o=new Date){const c=new Date(e.getFullYear(),e.getMonth(),e.getDate()),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()),s=new Date(o.getFullYear(),o.getMonth(),o.getDate());return s<c?"upcoming":s>d?"past":"ongoing"}async function L(){const e=document.querySelector(".events.container.table");if(!e)return;const o=[`${import.meta&&y?"/wdd330-final-project-guatemala-touristic-guide/":"/"}json/guatemala-events.json`,"json/guatemala-events.json","/json/guatemala-events.json","/public/json/guatemala-events.json","/src/public/json/guatemala-events.json","../json/guatemala-events.json","./public/json/guatemala-events.json"];try{console.debug("Events JSON fetch candidates:",o)}catch{}let c=null;const d=[];for(const t of o)try{const n=await fetch(t);d.push({path:t,ok:n.ok,status:n.status});try{console.log("main events fetch",{path:t,ok:n.ok,status:n.status})}catch{}if(!n.ok)continue;c=await n.clone().json();try{console.log("main events body",c)}catch{}break}catch(n){d.push({path:t,ok:!1,error:String(n)})}if(!c){e.innerHTML="";const t=document.createElement("div");t.className="no-events",t.textContent="No events this month",e.appendChild(t);const n=document.createElement("details");n.style.marginTop="10px";const i=document.createElement("summary");i.textContent="Debug: attempted event JSON paths (click to expand)",n.appendChild(i);const g=document.createElement("ul");d.forEach(r=>{const h=document.createElement("li");r.error?h.textContent=`${r.path} → error: ${r.error}`:h.textContent=`${r.path} → ok: ${r.ok} ${r.status?`(HTTP ${r.status})`:""}`,g.appendChild(h)}),n.appendChild(g),e.appendChild(n);try{console.warn("Events JSON fetch failed; attempted paths:",d)}catch{}return}const s=new Date,u=s.getMonth(),m=c.map(t=>{const n=E(t.date&&t.date.start),i=E(t.date&&t.date.end)||n,g=new Date(s.getFullYear(),n.mm-1,n.dd);let r=new Date(s.getFullYear(),i.mm-1,i.dd);r<g&&(r=new Date(r.getFullYear()+1,r.getMonth(),r.getDate()));const h=S(g,r,s);return{raw:t,startDate:g,endDate:r,status:h}}).filter(t=>t.startDate.getMonth()===u),l={ongoing:0,upcoming:1,past:2};if(m.sort((t,n)=>t.startDate-n.startDate!==0?t.startDate-n.startDate:l[t.status]-l[n.status]),e.innerHTML="",!m||m.length===0){const t=document.createElement("div");t.className="no-events",t.textContent="No events this month",e.appendChild(t);return}m.forEach(t=>{const n=document.createElement("article");n.className="mini-event-card",n.classList.add(`mini-event--${t.status}`);const i=document.createElement("div");i.className="mini-event__left";const g=document.createElement("div");g.className="mini-event__name",g.textContent=t.raw.name;const r=document.createElement("div");r.className="mini-event__date";const h=t.startDate;r.textContent=h.toLocaleDateString(void 0,{month:"short",day:"numeric"}),i.appendChild(g),i.appendChild(r),n.appendChild(i),e.appendChild(n)})}document.addEventListener("DOMContentLoaded",()=>{try{L()}catch(e){console.error("renderMainEventsGadget failed:",e);const a=document.querySelector(".events.container.table");if(a){a.innerHTML="";const o=document.createElement("div");o.className="no-events",o.textContent="Events could not be loaded (see console for details)",a.appendChild(o)}}});
